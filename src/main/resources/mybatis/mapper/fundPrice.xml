<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fundPrice">

    <resultMap id="fundPriceMap" type="com.jxnu.finance.store.entity.fund.FundCurrentPrice">
        <result property="fundcode" column="fundcode"/>
        <result property="dwjz" column="dwjz"/>
        <result property="gztime" column="gztime"/>
        <result property="jzrq" column="jzrq"/>
        <result property="gsz" column="gsz"/>
        <result property="gszzl" column="gszzl"/>
    </resultMap>

    <insert id="insert" parameterType="java.util.List">
        INSERT tbl_fund_current_price(fundcode,dwjz,gztime,jzrq,gsz,gszzl)
        VALUES
        <foreach collection="list" separator="," item="o">
            (#{o.fundcode},#{o.dwjz},#{o.gztime},#{o.jzrq},#{o.gsz},#{o.gszzl})
        </foreach>
    </insert>

    <!--每天中午收盘前，下午收盘前15分钟，正常每30分钟执行一次-->
    <select id="queryFundPrice" resultMap="fundPriceMap" parameterType="java.util.Map">
        SELECT *  FROM tbl_fund_current_price t WHERE DATE_FORMAT(t.`gztime` ,'%Y-%m-%d') = DATE_FORMAT(NOW(), '%Y-%m-%d')
        AND t.`gztime` &gt;= DATE_ADD(NOW(),

        <choose>
            <when test="params != null and params != '' and params='hour'">
                INTERVAL - 3 HOUR
            </when>
            <otherwise>
                INTERVAL - 30 MINUTE
            </otherwise>
        </choose>

        ) AND t.gztime &lt;= NOW()
    </select>

</mapper>
